/**
 * GitHub Copilot integration utilities
 */

const fs = require('fs');
const path = require('path');

/**
 * Generate GitHub Copilot instructions content
 */
function generateCopilotInstructions() {
  return `# GitHub Copilot Instructions - Tech Hub Skills

## Overview
This workspace uses Tech Hub Skills - 110+ production-ready AI agent skills for software engineering.

## Available Expert Roles

### Orchestrator
- **Focus**: Project coordination
- **Skills**: Routes all

### AI Engineer
- **Focus**: LLMs, RAG, Agents
- **Skills**: 8 specialized capabilities

### Data Engineer
- **Focus**: Pipelines, Lakehouse
- **Skills**: 9 specialized capabilities

### ML Engineer
- **Focus**: Training, Serving, MLOps
- **Skills**: 9 specialized capabilities

### Data Scientist
- **Focus**: Analytics, Modeling
- **Skills**: 8 specialized capabilities

### Security Architect
- **Focus**: PII, IAM, Compliance
- **Skills**: 7 specialized capabilities

### System Design
- **Focus**: Architecture, Scalability
- **Skills**: 8 specialized capabilities

### Platform Engineer
- **Focus**: IDP, SLOs
- **Skills**: 6 specialized capabilities

### Data Governance
- **Focus**: Catalog, Lineage, Quality
- **Skills**: 6 specialized capabilities

### DevOps
- **Focus**: CI/CD, Containers, IaC
- **Skills**: 9 specialized capabilities

### MLOps
- **Focus**: Experiments, Registry
- **Skills**: 9 specialized capabilities

### FinOps
- **Focus**: Cost Optimization
- **Skills**: 8 specialized capabilities

### Azure
- **Focus**: Azure Services
- **Skills**: 12 specialized capabilities

### Code Review
- **Focus**: PR Automation, Quality Gates
- **Skills**: 5 specialized capabilities

### Product Designer
- **Focus**: Requirements, UX
- **Skills**: 6 specialized capabilities

## How to Use These Skills

When working on tasks, Copilot will reference these expert roles automatically. You can also:

1. **Mention roles in comments**: \`// Using AI Engineer approach for RAG pipeline\`
2. **Request specific expertise**: \`# Apply Security Architect best practices\`
3. **Combine roles**: \`/* DevOps + FinOps: optimize CI/CD costs */\`

## Coding Standards

### Security (Security Architect)
- Always validate and sanitize user inputs
- Implement proper authentication and authorization
- Never hardcode secrets or credentials
- Use parameterized queries to prevent SQL injection
- Apply principle of least privilege
- Scan for PII before logging

### AI/ML Development (AI Engineer)
- Implement guardrails for LLM outputs
- Use prompt templates for consistency
- Monitor token usage and costs
- Implement proper error handling for API calls
- Cache embeddings when possible
- Version control prompts and models

### Data Engineering (Data Engineer)
- Follow medallion architecture (bronze/silver/gold)
- Implement idempotent pipelines
- Add data quality checks at each stage
- Use partitioning for large datasets
- Implement proper error handling and retries
- Document data lineage

### DevOps Practices
- Write infrastructure as code (IaC)
- Implement CI/CD pipelines
- Use containerization (Docker)
- Apply GitOps principles
- Implement monitoring and alerting
- Automate testing at all levels

## Project Structure

Follow these conventions:
- \`/src\` - Source code
- \`/tests\` - Test files
- \`/docs\` - Documentation
- \`/infrastructure\` - IaC templates
- \`/pipelines\` - CI/CD configurations
- \`/.github\` - GitHub workflows and configurations

## Quality Gates

All code should:
- ✓ Pass unit tests (>80% coverage)
- ✓ Pass linting and formatting
- ✓ Include error handling
- ✓ Have inline documentation
- ✓ Follow security best practices
- ✓ Be optimized for performance

## Tech Hub Skills Integration

These instructions are generated from Tech Hub Skills package.
To update: \`npx tech-hub-skills install --copilot\`

---
*Generated by Tech Hub Skills v1.0.0*
`;
}

/**
 * Install GitHub Copilot instructions to project
 */
function installCopilotInstructions(options = {}) {
  const projectDir = process.cwd();
  const githubDir = path.join(projectDir, '.github');
  const copilotFile = path.join(githubDir, 'copilot-instructions.md');

  // Check if file exists
  if (fs.existsSync(copilotFile) && !options.force) {
    console.log(`  ⚠️  Copilot instructions already exist at: ${copilotFile}`);
    console.log(`      Use --force to overwrite`);
    return false;
  }

  // Create .github directory if needed
  if (!fs.existsSync(githubDir)) {
    fs.mkdirSync(githubDir, { recursive: true });
  }

  // Write instructions
  const content = generateCopilotInstructions();
  fs.writeFileSync(copilotFile, content, 'utf8');

  console.log(`  ✓ GitHub Copilot instructions created: ${copilotFile}`);
  return true;
}

module.exports = {
  generateCopilotInstructions,
  installCopilotInstructions
};
